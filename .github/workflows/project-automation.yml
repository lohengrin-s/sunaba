# .github/workflows/project-automation.yml
name: Move Issue in Project

on:
  issues:
    types: [opened, labeled, edited, reopend]

jobs:
  move-issue:
    runs-on: ubuntu-latest
    environment: ActionsSecret
    steps:
      - name: Move issue to appropriate project column
        uses: actions/github-script@v7
        env:
          GH_TOKEN: ${{ secrets.API_TOKEN }}
        with:
          script: |
            const issueId = context.payload.issue.node_id;
            
            const projectNumber = 1; // あなたのProjects番号に変更してください
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // プロジェクトID取得
            const { repository } = await github.graphql(`
              query($owner: String!, $repo: String!, $projectNumber: Int!) {
                repository(owner: $owner, name: $repo) {
                  projectV2(number: $projectNumber) {
                    id
                  }
                }
              }
            `, {
              owner,
              repo,
              projectNumber
            });

            const projectId = repository.projectV2.id;

            // カードをProjectに追加
            await github.graphql(`
              mutation($projectId: ID!, $contentId: ID!) {
                addProjectV2ItemById(input: {projectId: $projectId, contentId: $contentId}) {
                  item {
                    id
                  }
                }
              }
            `, {
              projectId,
              contentId: issueId
            });

            console.log(`✅ Issue ${issueId} を Project ${projectId} に追加しました。`);
