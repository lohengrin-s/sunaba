# .github/workflows/project-automation.yml
name: Move Issue in Project

on:
  issues:
    types: [opened, labeled, edited, reopend]

jobs:
  move-issue:
    runs-on: ubuntu-latest
    environment: ActionsSecret
    steps:
      - name: Move issue to appropriate project column
        uses: actions/github-script@v7
        env:
          GH_TOKEN: ${{ secrets.API_TOKEN }}
        with:
          script: |
            const issueId = context.payload.issue.node_id;
            
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            const projectId = "PVT_kwHOAGqg_84A5tL2";

            // カードをProjectに追加
            await github.graphql(`
              mutation($projectId: ID!, $contentId: ID!) {
                addProjectV2ItemById(input: {projectId: $projectId, contentId: $contentId}) {
                  item {
                    id
                  }
                }
              }
            `, {
              projectId,
              contentId: issueId
            }, {
              headers: {
                Authorization: `Bearer ${process.env.GH_TOKEN}`
              }
            });

            console.log(`✅ Issue ${issueId} を Project ${projectId} に追加しました。`);
